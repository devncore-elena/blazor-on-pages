@page "/quiz"
@using BlazorQuiz.Shared
@inject HttpClient Http

<div class="main">
    <div class="box">
        @if (quiz == null)
        {
            <p><em>Loading...</em></p>
        }
        else
        {
            <div class="quiz-progress">
                @for (int i = 1; i <= 5; i++)
                {
                    if (i < current)
                    {
                        <div class="quiz-progress-box"/>
                    }
                }
            </div>

            if (current < 6)
            {
                <div class="quiz">
                    <div class="quiz-title">@quiz.Question</div>

                    @foreach (var answer in quiz.Answers)
                    {
                        <div class="quiz-answer" @onclick="()=> Choice(answer)">@answer.Example</div>
                    }
                </div>
            }
            else
            {
                <div class="quiz-gameover">Game Over</div>
                <div class="quiz-result">총 @questionCount 문제 중에 <span>@correctCount</span> 문제 정답</div>

                <div class="quiz-message">@resultMessage</div>

                <div class="quiz-buttons">
                    <button @onclick="Reset" class="quiz-retry">다시하기</button>
                </div>
            }
        }
    </div>
</div>

@code {
    private int questionCount = 5;
    private int correctCount = 0;
    private int current = 0;
    private string resultMessage;

    private QuizModel[] quizs;
    private QuizModel quiz;

    private string message0 = "뭐냐이거..";
    private string message1 = "나원참... 하기싫으신가요..";
    private string message2 = "분발하셔야합니다.. 차분하게 해보세요..";
    private string message3 = "어중간하네요.. 다시해보세요..";
    private string message4 = "아깝다.. 한번더 도전?";
    private string message5 = "축하드립니다!! 고인물 인정!!";

    protected override async Task OnInitializedAsync()
    {
        await Reset();
    }

    private async Task Reset()
    {
        quizs = await Http.GetFromJsonAsync<QuizModel[]>("QuizData");
        current = 0;
        correctCount = 0;
        Next();
    }

    private void Next()
    {
        if (current < 5)
        {
            quiz = quizs[current];
        }
        else
        {
            resultMessage = GetResultMessage(correctCount);
        }

        current++;
    }

    private void Choice(AnswerModel answer)
    {
        if(answer.IsAnswer)
        {
            correctCount++;
        }

        Next();
    }

    private string GetResultMessage(int correctCount)
    {
        string ment ="";

        switch (correctCount)
        {
            case 0: ment = message0; break;
            case 1: ment = message1; break;
            case 2: ment = message2; break;
            case 3: ment = message3; break;
            case 4: ment = message4; break;
            case 5: ment = message5; break;
        }

        return ment;
    }
}
